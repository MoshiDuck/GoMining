<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Simulateur GoMining Friendly</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial, sans-serif; background: #f0f3f5; color: #333; padding: 20px; }
h1 { color: #2c3e50; text-align: center; }
.container { max-width: 900px; margin: auto; }
.card { background: white; padding: 15px; margin: 15px 0; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
label { display: block; margin-top: 10px; font-weight: bold; }
input, select { padding: 5px; margin-top: 5px; width: 120px; }
button { margin-top: 15px; padding: 10px 20px; background: #27ae60; color: white; border: none; cursor: pointer; border-radius: 5px;}
button:hover { background: #2ecc71; }
table { border-collapse: collapse; width: 100%; margin-top: 15px; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
th { background: #2980b9; color: white; }
canvas { margin-top: 20px; background: white; padding: 10px; border-radius: 8px; }
.info { font-size: 0.9em; color: #555; margin-top: 5px;}
</style>
</head>
<body>
<div class="container">
<h1>Simulateur GoMining Friendly</h1>

<div class="card">
  <label>TH actuel : <input type="number" id="th" value="28"></label>
  <label>Remise (%) : <input type="number" id="remise" value="24.4"></label>
  <label>Watt/TH : <input type="number" id="watt" value="15"></label>
  <label>Strat√©gie : 
    <select id="strategy">
      <option value="gomining">Gomining (cumul√©)</option>
      <option value="reinvest">R√©investissement (pas cumul√©s)</option>
    </select>
  </label>
  <label>P√©riode : 
    <select id="unit">
      <option value="1">Jours</option>
      <option value="2">Mois</option>
      <option value="3">Ann√©es</option>
    </select>
  </label>
  <label>Nombre : <input type="number" id="timeValue" value="5"></label>
  <button onclick="simulate()">Simuler</button>
  <div class="info">üí° En Gomining les r√©compenses sont cumul√©es, en R√©investissement elles ne le sont pas.</div>
</div>

<div class="card table-container">
  <table id="resultTable">
    <thead>
      <tr>
        <th>Unit√©</th>
        <th>Puissance TH</th>
        <th>Gain/Jour</th>
        <th>Gain/Mois</th>
        <th>Gain/Ann√©e</th>
        <th>GMT</th>
        <th>USD</th>
        <th>Satoshi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="card">
  <canvas id="chart" width="800" height="300"></canvas>
</div>
</div>

<script>
let chartInstance = null;

async function simulate() {
  const thInput = parseFloat(document.getElementById("th").value);
  const remise = parseFloat(document.getElementById("remise").value);
  const watt = parseFloat(document.getElementById("watt").value);
  const strategy = document.getElementById("strategy").value;
  const unit = document.getElementById("unit").value;
  const timeValue = parseInt(document.getElementById("timeValue").value);

  const res = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,gmt-token&vs_currencies=usd,eur");
  const data = await res.json();
  const btcUSD = data.bitcoin.usd;
  const gmtUSD = data["gmt-token"].usd;

  let totalDays = 1;
  if (unit == "1") totalDays = timeValue;
  else if (unit == "2") totalDays = timeValue * 30;
  else if (unit == "3") totalDays = timeValue * 365;

  let th = thInput;
  let tbody = document.querySelector("#resultTable tbody");
  tbody.innerHTML = "";

  let labels = [];
  let thHistory = [];
  let gainHistory = [];

  let cumulativeRewardSat = 0;

  for (let day = 1; day <= totalDays; day++) {
    // Calcul reward net
    const electricityFee = (0.05*24*watt/gmtUSD/1000)*(1-remise/100);
    const serviceFee = (0.0089/gmtUSD)*(1-remise/100);
    const rewardPerTH = 49;
    const rewardNet = rewardPerTH*th - (electricityFee*th + serviceFee*th); // satoshi

    let displayReward = rewardNet;
    if(strategy=="gomining") cumulativeRewardSat += rewardNet; else cumulativeRewardSat = rewardNet;

    // R√©investissement quotidien
    if(strategy=="reinvest"){
      const rewardUSD = (rewardNet/1e8)*btcUSD;
      const reinvestUSD = rewardUSD*1.05;
      const thBought = reinvestUSD/28;
      th += thBought;
    }

    // Affichage par mois / ann√©e / jour
    if ((unit=="2" && day%30==0) || (unit=="3" && day%365==0) || unit=="1") {
      const rewardUSD = (displayReward/1e8)*btcUSD;
      const rewardGMT = rewardUSD/gmtUSD;

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${unit=="1"?day:unit=="2"?day/30:day/365}</td>
        <td>${th.toFixed(6)}</td>
        <td>${displayReward.toFixed(2)}</td>
        <td>${(displayReward*30).toFixed(2)}</td>
        <td>${(displayReward*365).toFixed(2)}</td>
        <td>${rewardGMT.toFixed(6)}</td>
        <td>${rewardUSD.toFixed(6)}</td>
        <td>${displayReward.toFixed(2)}</td>
      `;
      tbody.appendChild(row);

      labels.push(unit=="1"?day:unit=="2"?day/30:day/365);
      thHistory.push(th);
      gainHistory.push(displayReward);
    }
  }

  // Mettre √† jour ou cr√©er le graphique
  if(chartInstance) chartInstance.destroy();
  const ctx = document.getElementById("chart").getContext("2d");
  chartInstance = new Chart(ctx, {
    type: "line",
    data: {
      labels: labels,
      datasets: [
        { label: "TH actuel", data: thHistory, borderColor: "blue", fill: false, tension: 0.3 },
        { label: strategy=="gomining"?"Gain cumulatif sat":"Gain actuel sat", data: gainHistory, borderColor: "green", fill: false, tension: 0.3 }
      ]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: "top" }, tooltip: { mode: 'index', intersect: false } },
      scales: { y: { beginAtZero: true } }
    }
  });
}
</script>

</body>
</html>
