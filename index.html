<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Simulateur GoMining</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial, sans-serif; background: #f7f7f7; color: #333; padding: 20px; }
h1 { color: #2c3e50; }
label { display: block; margin-top: 10px; }
input, select { padding: 5px; margin-top: 5px; width: 100px; }
button { margin-top: 15px; padding: 10px 20px; background: #27ae60; color: white; border: none; cursor: pointer; }
button:hover { background: #2ecc71; }
.table-container { margin-top: 20px; overflow-x: auto; }
table { border-collapse: collapse; width: 100%; background: white; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
th { background: #2980b9; color: white; }
canvas { margin-top: 20px; background: white; padding: 10px; border-radius: 8px; }
</style>
</head>
<body>

<h1>Simulateur GoMining Friendly</h1>

<div>
  <label>TH actuel : <input type="number" id="th" value="28"></label>
  <label>Remise (%) : <input type="number" id="remise" value="24.4"></label>
  <label>Watt/TH : <input type="number" id="watt" value="15"></label>
  <label>Stratégie : 
    <select id="strategy">
      <option value="gomining">Gomining</option>
      <option value="reinvest">Réinvestissement</option>
    </select>
  </label>
  <label>Période : 
    <select id="unit">
      <option value="1">Jours</option>
      <option value="2">Mois</option>
      <option value="3">Années</option>
    </select>
  </label>
  <label>Nombre : <input type="number" id="timeValue" value="5"></label>
  <button onclick="simulate()">Simuler</button>
</div>

<div class="table-container">
  <table id="resultTable">
    <thead>
      <tr>
        <th>Unité</th>
        <th>Puissance TH</th>
        <th>Gain/Jour</th>
        <th>Gain/Mois</th>
        <th>Gain/Année</th>
        <th>GMT</th>
        <th>USD</th>
        <th>Satoshi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<canvas id="chart" width="600" height="300"></canvas>

<script>
// Simulateur
async function simulate() {
  const thInput = parseFloat(document.getElementById("th").value);
  const remise = parseFloat(document.getElementById("remise").value);
  const watt = parseFloat(document.getElementById("watt").value);
  const strategy = document.getElementById("strategy").value;
  const unit = document.getElementById("unit").value;
  const timeValue = parseInt(document.getElementById("timeValue").value);

  // Récupération des prix via CoinGecko
  const res = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,gmt-token&vs_currencies=usd,eur");
  const data = await res.json();
  const btcUSD = data.bitcoin.usd;
  const gmtUSD = data["gmt-token"].usd;

  // Conversion période en jours
  let totalDays = 1;
  if (unit == "1") totalDays = timeValue;
  else if (unit == "2") totalDays = timeValue * 30;
  else if (unit == "3") totalDays = timeValue * 365;

  let th = thInput;
  let tbody = document.querySelector("#resultTable tbody");
  tbody.innerHTML = "";

  let labels = [];
  let thHistory = [];
  let gainHistory = [];

  for (let day = 1; day <= totalDays; day++) {
    // Calcul reward net
    const electricityFee = (0.05*24*watt/gmtUSD/1000)*(1-remise/100);
    const serviceFee = (0.0089/gmtUSD)*(1-remise/100);
    const rewardPerTH = 49;
    const rewardNet = rewardPerTH*th - (electricityFee*th + serviceFee*th); // en satoshi

    // Réinvestissement
    if (strategy == "reinvest") {
      const rewardUSD = (rewardNet/1e8)*btcUSD;
      const reinvestUSD = rewardUSD*1.05;
      const thBought = reinvestUSD/28;
      th += thBought;
    }

    // Affichage par mois / année / jour
    if ((unit=="2" && day%30==0) || (unit=="3" && day%365==0) || unit=="1") {
      const rewardUSD = (rewardNet/1e8)*btcUSD;
      const rewardGMT = rewardUSD/gmtUSD;

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${unit=="1"?day:unit=="2"?day/30:day/365}</td>
        <td>${th.toFixed(6)}</td>
        <td>${rewardNet.toFixed(2)}</td>
        <td>${(rewardNet*30).toFixed(2)}</td>
        <td>${(rewardNet*365).toFixed(2)}</td>
        <td>${rewardGMT.toFixed(6)}</td>
        <td>${rewardUSD.toFixed(6)}</td>
        <td>${rewardNet.toFixed(2)}</td>
      `;
      tbody.appendChild(row);

      labels.push(unit=="1"?day:unit=="2"?day/30:day/365);
      thHistory.push(th);
      gainHistory.push(rewardNet);
    }
  }

  // Graphique
  const ctx = document.getElementById("chart").getContext("2d");
  new Chart(ctx, {
    type: "line",
    data: {
      labels: labels,
      datasets: [
        { label: "TH actuel", data: thHistory, borderColor: "blue", fill: false },
        { label: "Gain en sat", data: gainHistory, borderColor: "green", fill: false }
      ]
    },
    options: { responsive: true, plugins: { legend: { position: "top" } } }
  });
}
</script>

</body>
</html>
