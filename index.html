<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi Crypto - BTC & GMT</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --background-color: #f5f7fa;
            --card-color: #ffffff;
            --text-color: #333333;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --error-color: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            margin-bottom: 10px;
        }

        .last-updated {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: var(--card-color);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .card-icon {
            font-size: 1.5rem;
        }

        .card-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 10px 0;
        }

        .card-change {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .positive {
            background-color: rgba(39, 174, 96, 0.2);
            color: var(--success-color);
        }

        .negative {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--error-color);
        }

        .card-footer {
            margin-top: 15px;
            font-size: 0.8rem;
            color: #777;
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .error-message {
            color: var(--error-color);
            font-weight: 600;
            margin-top: 10px;
        }

        .refresh-btn {
            display: block;
            margin: 0 auto;
            padding: 10px 20px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }

        .refresh-btn:hover {
            background-color: #2980b9;
        }

        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #777;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Suivi des Cryptomonnaies</h1>
        <p class="last-updated">Derni√®re mise √† jour: <span id="last-update-time">-</span></p>
    </header>

    <main>
        <div class="dashboard">
            <div class="card" id="btc-price-card">
                <div class="card-header">
                    <div class="card-title">Prix Bitcoin (BTC)</div>
                    <div class="card-icon">‚Çø</div>
                </div>
                <div class="card-value" id="btc-price">Chargement...</div>
                <div class="card-change" id="btc-change">24h: -</div>
                <div class="card-footer">
                    Donn√©es fournies par CoinGecko
                </div>
            </div>

            <div class="card" id="btc-hashrate-card">
                <div class="card-header">
                    <div class="card-title">Hashrate Bitcoin</div>
                    <div class="card-icon">‚õèÔ∏è</div>
                </div>
                <div class="card-value" id="btc-hashrate">Chargement...</div>
                <div class="card-footer">
                    Donn√©es fournies par CoinGecko
                </div>
            </div>

            <div class="card" id="gmt-price-card">
                <div class="card-header">
                    <div class="card-title">Prix GMT Token</div>
                    <div class="card-icon">ü™ô</div>
                </div>
                <div class="card-value" id="gmt-price">Chargement...</div>
                <div class="card-change" id="gmt-change">24h: -</div>
                <div class="card-footer">
                    Donn√©es fournies par CoinGecko
                </div>
            </div>
        </div>

        <button class="refresh-btn" id="refresh-btn">Actualiser les donn√©es</button>
    </main>

    <footer>
        <p>Les donn√©es sont actualis√©es automatiquement toutes les 5 minutes</p>
        <p>‚ö†Ô∏è Ce site est √† but informatif uniquement. Les investissements en cryptomonnaies sont risqu√©s.</p>
    </footer>

    <script>
        // Configuration
        const COINGECKO_API_BASE = 'https://api.coingecko.com/api/v3';
        const UPDATE_INTERVAL = 5 * 60 * 1000; // 5 minutes en millisecondes
        const RETRY_DELAY = 30000; // 30 secondes en cas d'erreur

        // √âl√©ments DOM
        const btcPriceElement = document.getElementById('btc-price');
        const btcChangeElement = document.getElementById('btc-change');
        const btcHashrateElement = document.getElementById('btc-hashrate');
        const gmtPriceElement = document.getElementById('gmt-price');
        const gmtChangeElement = document.getElementById('gmt-change');
        const lastUpdateTimeElement = document.getElementById('last-update-time');
        const refreshButton = document.getElementById('refresh-btn');
        const cards = document.querySelectorAll('.card');

        // Variables d'√©tat
        let updateIntervalId = null;
        let lastSuccessfulUpdate = null;

        // Formateurs
        const formatCurrency = (value, currency = 'USD') => {
            return new Intl.NumberFormat('fr-FR', {
                style: 'currency',
                currency: currency,
                minimumFractionDigits: value < 1 ? 4 : 2,
                maximumFractionDigits: value < 1 ? 6 : 2
            }).format(value);
        };

        const formatHashrate = (hashrate) => {
            if (hashrate >= 1e18) {
                return (hashrate / 1e18).toFixed(2) + ' EH/s';
            } else if (hashrate >= 1e15) {
                return (hashrate / 1e15).toFixed(2) + ' PH/s';
            } else {
                return (hashrate / 1e12).toFixed(2) + ' TH/s';
            }
        };

        const formatPercentage = (value) => {
            return `${value >= 0 ? '+' : ''}${value.toFixed(2)}%`;
        };

        const formatTimestamp = (timestamp) => {
            return new Date(timestamp).toLocaleTimeString('fr-FR');
        };

        // Fonctions d'√©tat UI
        const setLoadingState = (isLoading) => {
            cards.forEach(card => {
                if (isLoading) {
                    card.classList.add('loading');
                } else {
                    card.classList.remove('loading');
                }
            });
            
            refreshButton.disabled = isLoading;
            refreshButton.textContent = isLoading ? 'Actualisation...' : 'Actualiser les donn√©es';
        };

        const showError = (element, message) => {
            element.innerHTML = `<span class="error-message">${message}</span>`;
        };

        // Fonctions API
        const fetchWithErrorHandling = async (url, options = {}) => {
            try {
                const response = await fetch(url, options);
                
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('Erreur de r√©cup√©ration:', error);
                throw new Error(`√âchec de la r√©cup√©ration des donn√©es: ${error.message}`);
            }
        };

        const fetchBitcoinData = async () => {
            try {
                // R√©cup√©ration du prix et des infos de march√©
                const marketData = await fetchWithErrorHandling(
                    `${COINGECKO_API_BASE}/coins/bitcoin?localization=false&tickers=false&market_data=true&community_data=false&developer_data=true&sparkline=false`
                );
                
                // R√©cup√©ration du hashrate depuis les donn√©es de d√©veloppement
                const hashrate = marketData.developer_data?.current_hashrate;
                if (hashrate === undefined || hashrate === null) {
                    throw new Error('Hashrate non disponible');
                }
                
                return {
                    price: marketData.market_data.current_price.usd,
                    priceChange24h: marketData.market_data.price_change_percentage_24h,
                    hashrate: hashrate
                };
            } catch (error) {
                console.error('Erreur dans fetchBitcoinData:', error);
                throw new Error(`Impossible de r√©cup√©rer les donn√©es Bitcoin: ${error.message}`);
            }
        };

        const fetchGMTData = async () => {
            try {
                // R√©cup√©ration du prix de GMT (Stepn)
                const marketData = await fetchWithErrorHandling(
                    `${COINGECKO_API_BASE}/coins/stepn?localization=false&tickers=false&market_data=true&community_data=false&developer_data=false&sparkline=false`
                );
                
                return {
                    price: marketData.market_data.current_price.usd,
                    priceChange24h: marketData.market_data.price_change_percentage_24h
                };
            } catch (error) {
                console.error('Erreur dans fetchGMTData:', error);
                throw new Error(`Impossible de r√©cup√©rer les donn√©es GMT: ${error.message}`);
            }
        };

        // Mise √† jour de l'interface
        const updateUI = (btcData, gmtData) => {
            // Mise √† jour des donn√©es Bitcoin
            if (btcData) {
                btcPriceElement.textContent = formatCurrency(btcData.price, 'USD');
                btcChangeElement.textContent = `24h: ${formatPercentage(btcData.priceChange24h)}`;
                btcChangeElement.className = `card-change ${btcData.priceChange24h >= 0 ? 'positive' : 'negative'}`;
                btcHashrateElement.textContent = formatHashrate(btcData.hashrate);
            }
            
            // Mise √† jour des donn√©es GMT
            if (gmtData) {
                gmtPriceElement.textContent = formatCurrency(gmtData.price, 'USD');
                gmtChangeElement.textContent = `24h: ${formatPercentage(gmtData.priceChange24h)}`;
                gmtChangeElement.className = `card-change ${gmtData.priceChange24h >= 0 ? 'positive' : 'negative'}`;
            }
            
            // Mise √† jour de l'horodatage
            lastSuccessfulUpdate = Date.now();
            lastUpdateTimeElement.textContent = formatTimestamp(lastSuccessfulUpdate);
        };

        // Fonction principale de mise √† jour
        const updateAllData = async (isManualRefresh = false) => {
            if (isManualRefresh) {
                setLoadingState(true);
            }
            
            try {
                // R√©cup√©ration en parall√®le des donn√©es
                const [btcData, gmtData] = await Promise.all([
                    fetchBitcoinData(),
                    fetchGMTData()
                ]);
                
                updateUI(btcData, gmtData);
                
                // R√©activation des intervalles en cas de succ√®s apr√®s une erreur
                if (updateIntervalId === null) {
                    startAutoUpdate();
                }
                
            } catch (error) {
                console.error('Erreur lors de la mise √† jour des donn√©es:', error);
                
                // Affichage des erreurs sp√©cifiques
                if (error.message.includes('Bitcoin')) {
                    showError(btcPriceElement, 'Erreur donn√©es BTC');
                    showError(btcHashrateElement, 'Donn√©es indisponibles');
                }
                
                if (error.message.includes('GMT')) {
                    showError(gmtPriceElement, 'Erreur donn√©es GMT');
                }
                
                // Arr√™t de l'auto-actualisation en cas d'erreur
                if (updateIntervalId !== null) {
                    clearInterval(updateIntervalId);
                    updateIntervalId = null;
                }
                
                // Nouvelle tentative apr√®s un d√©lai
                setTimeout(updateAllData, RETRY_DELAY);
            } finally {
                if (isManualRefresh) {
                    setLoadingState(false);
                }
            }
        };

        // Gestion de l'auto-actualisation
        const startAutoUpdate = () => {
            if (updateIntervalId !== null) {
                clearInterval(updateIntervalId);
            }
            
            updateIntervalId = setInterval(() => {
                updateAllData(false);
            }, UPDATE_INTERVAL);
        };

        // Initialisation
        const init = () => {
            // Premier chargement des donn√©es
            updateAllData(true);
            
            // Configuration du bouton de rafra√Æchissement
            refreshButton.addEventListener('click', () => {
                updateAllData(true);
            });
            
            // V√©rification p√©riodique de la fra√Æcheur des donn√©es
            setInterval(() => {
                if (lastSuccessfulUpdate && (Date.now() - lastSuccessfulUpdate) > UPDATE_INTERVAL * 1.5) {
                    lastUpdateTimeElement.innerHTML = `<span class="error-message">Donn√©es possibly obsol√®tes</span>`;
                }
            }, 60000); // V√©rifie toutes les minutes
        };

        // D√©marrage de l'application
        init();
    </script>
</body>
</html>
